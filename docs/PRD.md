# PRD: Telegram-бот "Факты о месте по геолокации"

## 1. Overview / Problem
Пользователю хочется получать интересные и необычные факты о местах, находящихся рядом с отправленной геолокацией, без лишних действий. Цель — создать MVP Telegram-бота, который принимает геометку, определяет интересное место поблизости и выдает факт о нём через GPT-4.1-mini.

## 2. Key User Flows
- Пользователь открывает Telegram-бота.
- Отправляет свою локацию (через стандартную функцию Telegram).
- Бот определяет координаты, ищет рядом достопримечательность и отправляет интересный факт через GPT.
- (v1.1) Пользователь включает live-location.
- Бот раз в 10 минут запрашивает обновлённую локацию и отправляет новый факт.

## 3. Functional Requirements
- Бот должен принимать геолокацию в формате `location`-сообщения Telegram (`latitude`, `longitude`).
- Определение ближайшей достопримечательности должно быть основано на запросах к Wikipedia API.
- Факт о месте должен быть сгенерирован с помощью OpenAI GPT-4.1-mini.
- Возможность тестирования на заранее подготовленном наборе координат известных мест.
- Интеграция с Wikipedia API для получения эталонных данных о достопримечательностях.
- Бот должен логировать:
  - Входящие координаты.
  - Найденные достопримечательности.
  - Ответы GPT для последующего анализа точности.
- Точность определения места должна быть проверяема через сравнение с эталонными данными.
- (v1.1) Поддержка live-location с автообновлением каждые 10 минут.

## 4. Non-Goals
- Нет поддержки текстовых сообщений от пользователя.
- Не требуется кэширование результатов.
- Нет полноценной базы данных или авторизации.
- Не обрабатываются фотографии, голосовые или иные типы сообщений.

## 5. Milestones & Release Plan

### MVP v1.0 (один вечер)
- [x] Создать Telegram-бота и настроить webhook.
- [x] Принимать `location` от пользователя.
- [x] Запрашивать ближайшую достопримечательность через Wikipedia API.
- [x] Генерировать интересный факт через GPT-4.1-mini.
- [x] Отправлять факт пользователю.

### v1.1
- [ ] Поддержка live-location от Telegram.
- [ ] Отправка нового факта каждые 10 минут.
- [ ] Сохранение истории по пользователю.

### Testing & Validation
- [ ] Сбор тестового датасета координат достопримечательностей через Wikipedia API.
- [ ] Автоматическое тестирование точности определения мест.
- [ ] Валидация фактов через GPT-4.1-mini.
- [ ] Парсинг данных из категорий "Достопримечательности" Wikipedia.

## 6. Testing Strategy

### Тестирование парсинга координат из Telegram
- Юнит-тесты на извлечение `latitude` и `longitude` из payload Telegram-сообщения типа `location`.
- Интеграционные тесты с симулированной отправкой сообщений.

### Проверка корректности определения места по координатам
- Сравнение результата Wikipedia API с известными данными из датасета.
- Проверка радиусного поиска (например, 500 м, 1 км) по координатам.

### План создания тестового набора данных
- Использование Wikipedia API с фильтром по категориям "Достопримечательности", "Исторические места", "Музеи".
- Геоэнкодинг их координат (если нужно).
- Формирование CSV-файла с `name`, `lat`, `lon`, `описание`.

### Критерии успешного распознавания места
- Accuracy threshold: минимум 80% совпадений с ожидаемыми результатами.
- Допустимое расстояние от реального места: до 500 м.
- Факт должен быть релевантен найденной достопримечательности (проверяется вручную или через эвристику по ключевым словам).
